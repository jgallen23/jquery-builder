<!DOCTYPE html>
<html>
  <head>
    <title>jQuery Builder</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/hint.min.css"/>
    <style>
      h2, h3, h4 {
        font-weight: normal;
      }
      .side h2 {
        border-bottom: 1px solid #E5E5E5;
        font-size: 24px;
        margin-top: 15px;
      }
      .cli h2 {
        margin-top: 0;
      }
      .build p {
        text-align: center;
        line-height: 38px;
      }
      .toggle {
        float: right;
      }      
      .footer {
        margin-top: 150px;
        border-top: 1px solid #eee;
        padding: 10px 0;
        font-size: 12px;
      }

      .footer p {
        margin: 0;
      }
      .footer ul {
        float: right;
      }
      .footer ul li {
        display: inline-block;
      }
      .hint:after,[data-hint]:after{
        min-width: 300px;
        white-space: normal;
        line-height: 1.3em;
        font-size: 85%;
      }
    </style>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24017782-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a href="https://github.com/jgallen23/jquery-builder"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
    <div class="container">
      <div class="row">
        <div class="span12">
          <h1>jQuery Builder</h1>
        </div>
      </div>
      <div class="row">
        <div class="span8">
          <p class="lead">jQuery Builder lets you easily build a custom version of jQuery that just includes the modules you need.</p>
          <p class="lead">Choose which modules you'd like to include in your custom build:</p>
          <form>
            <div class="row">
              <div class="span3">
                <legend>Options</legend>
                <div class="controls">
                  <label class="select">
                    <p>Version:</p>
                    <select id="version"></select>
                  </label>
                  <label class="checkbox">
                    Minify
                    <input type="checkbox" id="minify"/>
                  </label>
                </div>
              </div>
              <div class="span5">
                <legend>
                  <div class="toggle">
                    <button data-action="all" class="btn btn-mini">All</button>
                    <button data-action="none" class="btn btn-mini">None</button>
                  </div>
                  Modules
                </legend>
                <div class="control-group">
                  <ul data-role="modules"></ul>
                </div>
              </div>
            </div>
            <legend>Build</legend>
            <div class="row build">
              <div class="span1">
                <button class="btn btn-large btn-primary">Build</button>
              </div>
              <div class="span1">
                <p>or</p>
              </div>
              <div class="span6">
                <pre data-role="curl">curl http://...</pre>
              </div>
            </div>
          </form>
        </div>
        <div class="side span4">
          <div class="cli">
            <h2>CLI</h2>
            <p>You can also build a custom version of jQuery using the node.js cli tool.</p>
            <h4>Install</h4>
            <code>npm install -g jquery-builder</code>
            <h4>Usage</h4>
            <code>jquery-builder --exclude ajax,css -m</code>
            <h4>Usage Options</h4>
            <code>jquery-builder --help</code>
          </div>
          <div class="todo">
            <h2>Todo</h2>
            <ul>
              <li>Show filesize for each module.</li>
              <li>Remember selected modules</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer">
        <ul class="unstyled">
          <li>Built With:</li>
          <li><a href="http://twitter.github.com/bootstrap/">Bootstrap</a></li>
          <li><a href="http://jquery.com">jQuery</a></li>
          <li><a href="https://github.com/jgallen23/boots">Boots</a></li>
        </ul>
        <p>Built by: <a href="http://github.com/jgallen23">Greg Allen</a> (<a href="http://twitter.com/jgaui">@jgaui</a>)</p>
      </div>
    </div>
    <script src="lib/jquery-css-dimensions-effects-offset.min.js"></script>
    <script src="lib/filename.js"></script>
    <script>
      var currentFile = '';
      var versions, descriptions;
      $.get('data.json', function(data) {  
        versions = data.versions;
        descriptions = data.descriptions;

        //versions
        el = $('#version');
        html = [];
        for (var version in versions) {
          html.push('<option value="'+version+'">'+version+'</option>');
        }
        el.html(html.join(''));
        el.on('change', updateModules);
        updateModules();

      }, 'json');

      var updateModules = function() {

        var modules = versions[$('#version').val()];
        //modules
        var el = $('[data-role=modules]');
        var html = [];
        for (var i = 0, c = modules.length; i < c; i++) {
          var description = descriptions[modules[i]]
            , hint_attrs = '';

          if (description)
            hint_attrs = 'class="hint--bottom hint--rounded" data-hint="' + description + '"';
          html.push('<li><span ' + hint_attrs + '><label class="chechbox"><input type="checkbox" value="'+modules[i]+'" checked> ' + modules[i] + ' </label></span></li>');
        }
        el.html(html.join(''));
        // $('[value=deprecated]').parent().append('<span>&nbsp;($.uaMatch, $.browser, $.sub)</span>');
        $('form [type=checkbox]').on('change', update);
        update();
      };

      var toggleAll = function(e) {
        $('[data-role=modules] [type=checkbox]').prop('checked', true);
        update();
        e.preventDefault();
      };

      var toggleNone = function(e) {
        $('[data-role=modules] [type=checkbox]').removeAttr('checked');
        update();
        e.preventDefault();
      };

      var update = function(e) {
        var exclude = [];
        $('ul input:not(:checked)').each(function(i, el) {
          exclude.push($(el).val());
        });

        var minify = ($('#minify').prop('checked') == true);

        var version = $('#version').val();

        //TODO: save exclude, minify
        currentFile = version + '/' + filename(exclude, minify);
        $('[data-role=curl]').html('curl https://raw.github.com/jgallen23/jquery-builder/0.3.0/dist/'+currentFile+' > jquery.js');
      };

      var submit = function(e) {
        if (!currentFile) {
          update();
        }
        _gaq.push(['_trackEvent', 'Download', 'jQuery', currentFile]);
        window.open('https://raw.github.com/jgallen23/jquery-builder/0.3.0/dist/'+currentFile);
        e.preventDefault();
      };
      $('form').on('submit', submit);
      $('[data-action=all]').on('click', toggleAll);
      $('[data-action=none]').on('click', toggleNone);
    </script>
  </body>
</html>
